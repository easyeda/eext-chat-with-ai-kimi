<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>AI Chat</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				padding: 20px;
			}
			#chat-container {
				border: 1px solid #ccc;
				height: 300px;
				overflow-y: scroll;
				padding: 10px;
			}
			#message-input {
				width: calc(100% - 110px);
				padding: 10px;
				margin-right: 10px;
			}
			#send-button {
				padding: 10px 20px;
			}
		</style>
	</head>
	<body>
		<div id="chat-container"></div>
		<input type="text" id="message-input" placeholder="Type your message here..." />
		<button id="send-button">Send</button>

		<script>
			// 等待DOM加载完成
			document.addEventListener('DOMContentLoaded', async () => {
				// 定义DOM元素
				const chatContainer = document.getElementById('chat-container');
				const messageInput = document.getElementById('message-input');
				const sendButton = document.getElementById('send-button');

				async function sendMessage(event) {
					event.preventDefault();

					const message = messageInput.value.trim();

					if (message) {
						displayMessage(`You: ${message}`);
						messageInput.value = '';

						const response = await runOpenAI(message);
						displayMessage(`AI: ${response}`);
					}
				}

				// 显示消息
				function displayMessage(message) {
					const messageDiv = document.createElement('div');
					messageDiv.textContent = message;
					chatContainer.appendChild(messageDiv);
					chatContainer.scrollTop = chatContainer.scrollHeight;
				}

				// 监听发送按钮
				sendButton.addEventListener('click', sendMessage);

				// 监听回车键
				messageInput.addEventListener('keypress', (event) => {
					if (event.key === 'Enter') {
						sendMessage(event);
					}
				});
			});

			// 调用接口
			async function runOpenAI(userMessage) {
				const openAiResponse = await fetch('https://api.moonshot.cn/v1/chat/completions', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
						'Authorization': 'Bearer sk-KRJ9vaCTGeXUqzLEbi13XXHbmrDZFQJVu8bzup7JRW0oOXiR',
					},
					body: JSON.stringify({
						model: 'moonshot-v1-8k',
						messages: [{ role: 'user', content: userMessage }],
						temperature: 0.3,
					}),
				});

				const data = await openAiResponse.json();
				console.log(data);
				return data.choices[0].message['content'];
			}
		</script>
	</body>
</html>
